{% extends 'wine/base.html' %}
{% load static %}

{% block content %}

<!-- Nav for search-->
<nav class="navbar navbar-toggleable-sm navbar-light bg-faded navbar-new">
  <div class="container findwine_nav--menu">
    <button class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
            aria-label="Toggle navigation">
        <span>
          <!-- Icon to be visible on search and wine details pages -->
          <img src="{% static 'wine/images/SVGs/menu-black.svg' %}" class="findwine_menu-button">
        </span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active nav-item-new">
          <a class="nav-link nav-link-new" href="{% url 'wine:search' %}">Home <span
            class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item nav-item-new">
          <a class="nav-link nav-link-new" href="{% url 'content:about' %}">About</a>
        </li>
      </ul>
    </div>
  </div>
  <!-- * This should only be visible on search results and wine details pages. Toggle class findwine_nav-logo-none -->
  <div class="findwine_nav-logo search-page-content">
    <a href="{% url 'wine:search' %}">
      <img src="{% static 'wine/images/SVGs/logo-black.svg' %}" class="d-inline-block align-top findwine_nav-logo-icon" alt="FindWine">
    </a>
  </div>
</nav>

<!--Insert all of the page specific content here-->
<div class="row findwine_detail-padding">

  <!--image - MOBILE-->
  <div class="col-4 hidden-md-up">
    {% if winevintage.image_pack_shot %}
    <img src="{{ winevintage.image_pack_shot.url }}" alt="{{ winevintage.wine.name }}"
         class="img-fluid rounded float-left findwine_detail-image">
    {% endif %}
  </div>

  <div class="col-6 hidden-sm-down findwine_detail-images-desktop">
    <div class="findwine_detail-images-small">
      {% if winevintage.image_pack_shot %}
      <div class="findwine_detail-image-1">
        <img src="{{ winevintage.image_pack_shot.url }}" alt="{{ winevintage.wine.name }}"
             class="img-fluid rounded float-left">
      </div>
      {% endif %}
      {% if winevintage.image_label_vertical %}
      <div class="findwine_detail-image-2">
        <img src="{{ winevintage.image_label_vertical.url }}" alt="{{ winevintage.wine.name }}"
             class="img-fluid rounded float-left">
      </div>
      {% endif %}
    </div>

    {# TODO: this will need to be updated based on the image that's clicked on the left #}
    {% if winevintage.image_pack_shot %}
    <div class="findwine_detail-image-main--holder">
      <img src="{{ winevintage.image_pack_shot.url }}" alt="{{ winevintage.wine.name }}"
           class="img-fluid rounded float-left findwine_detail-image-main">
    </div>
    {% endif %}
  </div>

  <!-- Wine detail -->
  <div class="col-8 col-md-6 findwine_producer">
    <!-- Wine name & vintage year-->
    <a href="{% url 'wine:producer_detail_by_slug' winevintage.wine.producer.slug %}" class="findwine_producer-main">
      {{ winevintage.wine.producer }} <img src="{% static 'wine/images/SVGs/arrow-right-grey.svg' %}"
                                           class="findwine_detail-right-arrow hidden-md-up"> </a>
    <h4 class="findwine_producer-vintage"> {{ winevintage.wine.name }} {{ winevintage.year }} </h4>

    <!-- Wine category & origin -->
    <p class="findwine_category">
      {{ winevintage.category }}
      {% if winevintage.blend %}
      {{ winevintage.blend }}
      {% endif %}
      {{ winevintage.sub_category.name }}
    </p>

    {% if winevintage.appellation %}

    <p class="findwine_place">
      <img src="{% static 'wine/images/SVGs/pinpoint.svg' %}" class="hidden-md-up">
      <img src="{% static 'wine/images/SVGs/pinpoint-grey.svg' %}" class="hidden-sm-down">
      {{winevintage.appellation.name}},
      {{ winevintage.appellation.get_country_display }}</p>
    {% endif %}

    <div class="findwine_awards-holder">
      <!-- Rating -->
      <div class="findwine_rating-box findwine_rating-box-{{ winevintage.rating_category }}">
        <p class="findwine_rating">{{ winevintage.rating.avg_rating|floatformat:1 }}</p>
      </div>

      <!-- Awards -->
      <div class="findwine_awards-container">
        {% if winevintage.wineaward_set.all %}
        <table style="width:100%">
          <tr>
            <th class="findwine_award-heading hidden-sm-down">AWARDS</th>
          </tr>
          <tr>
            {% for wineaward in winevintage.wineaward_set.all %}
            <td class="findwine_award-list">{{ wineaward.award }}</td>
            {% endfor %}
          </tr>
        </table>
        {% else %}
        <p>No awards captured.</p>
        {% endif %}
      </div>
    </div>

    <!-- Purchase options - Desktop -->
    <div class="hidden-sm-down">
      <div class="findwine_detail-heading">
        <h5 class="findwine_detail-header">PURCHASE OPTIONS</h5>
      </div>
      {% if winevintage.merchantwine_set.all %}
      <ul class="list-group list-group-flush">
        {% for merchantwine in winevintage.merchantwine_set.all %}
        <li class="list-group-item findwine_detail-list">
          <div class="findwine_merchant-holder">
            <div class="findwine_merchant-name"> {{ merchantwine.merchant.name }}</div>
            <div class="findwine_merchant-unit"> {{ merchantwine.purchase_unit }} ml (minimum {{merchantwine.minimum_purchase_unit }})
            </div>
            <div class="findwine_merchant-delivery"> Delivery: {{ merchantwine.merchant.delivery_fees }}</div>
          </div>
          <div class="findwine_merchant-pricing">
            <div class="findwine_merchant-currency"> R</div>
            <div class="findwine_merchant-price"> {{ merchantwine.rounded_price }}</div>
            <a class="btn findwine_buy-button" href={{ merchantwine.url }} target="_blank" role="button"> BUY</a>
          </div>
        </li>
        {% endfor %}
        {% else %}
        <p>No merchant availability.</p>
        {% endif %}
      </ul>
    </div>
  </div>
</div>
  <!-- Purchase options - Mobile -->
  <div class="row hidden-md-up">
    <div class="col-12">
      <div class="findwine_detail-heading">
        <h5 class="findwine_detail-header">PURCHASE OPTIONS</h5>
      </div>
      {% if winevintage.merchantwine_set.all %}
      <ul class="list-group list-group-flush">
        {% for merchantwine in winevintage.merchantwine_set.all %}
        <li class="list-group-item findwine_detail-list">
          <div class="findwine_merchant-holder">
            <div class="findwine_merchant-name"> {{ merchantwine.merchant.name }}</div>
            <div class="findwine_merchant-unit"> {{ merchantwine.purchase_unit }} ml (minimum {{ merchantwine.minimum_purchase_unit }})
            </div>
            <div class="findwine_merchant-delivery"> Delivery: {{ merchantwine.merchant.delivery_fees }}</div>
          </div>
          <div class="findwine_merchant-pricing">
            <div class="findwine_merchant-currency"> R</div>
            <div class="findwine_merchant-price"> {{ merchantwine.rounded_price }}</div>
            <a class="btn findwine_buy-button" href={{ merchantwine.url }} target="_blank" role="button"> BUY</a>
          </div>
        </li>
        {% endfor %}
        {% else %}
        <p>No merchant availability.</p>
        {% endif %}
      </ul>
    </div>
  </div>


  <!-- Wine info -->
<div class="findwine_detail-holder">
  <div class="findwine_detail-heading">
    <h5 class="findwine_detail-header findwine_detail-header--desktop">WINE INFO</h5>
  </div>

  {% if winevintage.description %}
  <div class="row findwine_detail-rowHeight" id="info">
    <div class="col-12 col-md-auto">
      <h5 class="findwine_detail-header--2">Description</h5>
      <p class="findwine_detail-content" id="infoContent">{{ winevintage.description }}</p>
      <!-- Include Read more button -->
    </div>
  </div>
  <div class="findwine_detail-expand hidden-md-up">
    <button class="btn findwine_detail-expand-button" type="button" id="infoButton" onclick="expandInfo()">
      More <img src="{% static 'wine/images/SVGs/arrow-down-green.svg' %}" class="findwine_detail-more-arrow">
    </button>
  </div>
  <div class="findwine_detail-heading"></div>
  {% endif %}

  <!-- Wine details -->
  <div class="row findwine_detail-rowHeight hidden-md-up" id="detail">
    <div class="col-12 col-md-auto">
      <h5 class="findwine_detail-header--2">Details</h5>
      <p class="findwine_detail-content" id="detailContent"> Read more about this wine.</p>
      <table class="table table-responsive table-sm">
        <tbody>
        {% if winevintage.winemakers.count %}
        <tr>
          <td class="findwine_detail-content-left">Winemaker:</td>
          <td class="findwine_detail-content">
            {% for winemaker in winevintage.winemakers.all %}
            {{ winemaker }}
            {% endfor %}
          </td>
        </tr>
        {% endif %}
        {% if winevintage.alcohol_percentage %}
        <tr>
          <td class="findwine_detail-content-left">Alcohol percentage:</td>
          <td class="findwine_detail-content-right">{{ winevintage.alcohol_percentage|floatformat:1 }}%</td>
        </tr>
        {% endif %}
        {% if winevintage.winegrape_set.all %}
        <tr>
          <td class="findwine_detail-content-left">Blend:</td>
          <td class="findwine_detail-content-right">
            <ul class="list-inline">
              {% for winegrape in winevintage.winegrape_set.all %}
              <li class="list-inline-item">{{ winegrape.grape }} {{ winegrape.percentage|floatformat:0 }}%</li>
              {% endfor %}
            </ul>
          </td>
        </tr>
        {% endif %}
        {% if winevintage.sweetness %}
        <tr>
          <td class="findwine_detail-content-left">Sweetness:</td>
          <td class="findwine_detail-content-right">{{ winevintage.sweetness }}</td>
        </tr>
        {% endif %}
        {% if winevintage.wooded %}
        <tr>
          <td class="findwine_detail-content-left">Wooded:</td>
          <td class="findwine_detail-content-right">{{ winevintage.wooded|yesno:"Wooded,Unwooded,Unknown" }}</td>
        </tr>
        {% endif %}
        {% if winevintage.organic %}
        <tr>
          <td class="findwine_detail-content-left">Organic:</td>
          <td class="findwine_detail-content-right">{{ winevintage.organic|yesno:"Yes,No,Unknown" }}</td>
        </tr>
        {% endif %}
        {% if winevintage.contains_sulphites %}
        <tr>
          <td class="findwine_detail-content-left">Contains Sulphites:</td>
          <td class="findwine_detail-content-right">{{ winevintage.contains_sulphites|yesno:"Yes,No,Unknown" }}</td>
        </tr>
        {% endif %}
        {% if winevintage.vegetarian %}
        <tr>
          <td class="findwine_detail-content-left">Vegetarian:</td>
          <td class="findwine_detail-content-right">{{ winevintage.vegetarian|yesno:"Yes,No,Unknown" }}</td>
        </tr>
        {% endif %}
        {% if winevintage.residual_sugar %}
        <tr>
          <td class="findwine_detail-content-left">Residual sugar:</td>
          <td class="findwine_detail-content-right">{{ winevintage.residual_sugar }} g/l</td>
        </tr>
        {% endif %}
        {% if winevintage.ph %}
        <tr>
          <td class="findwine_detail-content-left">pH:</td>
          <td class="findwine_detail-content-right">{{ winevintage.ph }}</td>
        </tr>
        {% endif %}
        {% if winevintage.total_acidity %}
        <tr>
          <td class="findwine_detail-content-left">Total acidity:</td>
          <td class="findwine_detail-content-right">{{ winevintage.total_acidity }} g/l</td>
        </tr>
        {% endif %}
        {% if winevintage.total_sulphur %}
        <tr>
          <td class="findwine_detail-content-left">Total sulphur:</td>
          <td class="findwine_detail-content-right">{{ winevintage.total_sulphur|floatformat:1 }} mg/l</td>
        </tr>
        {% endif %}
        </tbody>
      </table>
      <!-- Will add back later -->
      <!--{% if winevintage.tasting_notes %}-->
      <!--<a class="text-primary" style="margin-left:15px"-->
      <!--href="{{ winevintage.tasting_notes.url|default_if_none:'#' }}">Download tasting notes</a>-->
      <!--{% endif %}-->
    </div>
  </div>
  <div class="findwine_detail-expand hidden-md-up">
    <button class="btn findwine_detail-expand-button" type="button" id="detailButton" onclick="expandDetail()">
      More <img src="{% static 'wine/images/SVGs/arrow-down-green.svg' %}" class="findwine_detail-more-arrow">
    </button>
  </div>
  <div class="findwine_detail-heading"></div>


  <!-- Wine details and specs - Desktop -->
<div class="findwine_details-specs">
  <div class="row findwine_detail-rowHeight findwine_details-margin hidden-sm-down">
    <div class="col-12 col-md-auto">
      <h5 class="findwine_detail-header--2">Details</h5>
      <table class="table table-responsive table-sm">
        <tbody>
        {% if winevintage.winemakers.count %}
        <tr>
          <td class="findwine_detail-content-left">Winemaker:</td>
          <td class="findwine_detail-content-right">
            {% for winemaker in winevintage.winemakers.all %}
            {{ winemaker }}
            {% endfor %}
          </td>
        </tr>
        {% endif %}
        {% if winevintage.alcohol_percentage %}
        <tr>
          <td class="findwine_detail-content-left">Alcohol percentage:</td>
          <td class="findwine_detail-content-right">{{ winevintage.alcohol_percentage|floatformat:1 }}%</td>
        </tr>
        {% endif %}
        {% if winevintage.winegrape_set.all %}
        <tr>
          <td class="findwine_detail-content-left">Blend:</td>
          <td class="findwine_detail-content-right">
            <ul class="list-inline findwine_detail-list-inline-item">
              {% for winegrape in winevintage.winegrape_set.all %}
              <li class="list-inline-item findwine_detail-list-inline-item">{{ winegrape.grape }} {{ winegrape.percentage|floatformat:0 }}%</li>
              {% endfor %}
            </ul>
          </td>
        </tr>
        {% endif %}
        {% if winevintage.sweetness %}
        <tr>
          <td class="findwine_detail-content-left">Sweetness:</td>
          <td class="findwine_detail-content-right">{{ winevintage.sweetness }}</td>
        </tr>
        {% endif %}
        {% if winevintage.wooded %}
        <tr>
          <td class="findwine_detail-content-left">Wooded:</td>
          <td class="findwine_detail-content-right">{{ winevintage.wooded|yesno:"Wooded,Unwooded,Unknown" }}</td>
        </tr>
        {% endif %}
        {% if winevintage.organic %}
        <tr>
          <td class="findwine_detail-content-left">Organic:</td>
          <td class="findwine_detail-content-right">{{ winevintage.organic|yesno:"Yes,No,Unknown" }}</td>
        </tr>
        {% endif %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="row findwine_detail-rowHeight hidden-sm-down findwine_details-margin">
    <div class="col-12 col-md-auto">
      <h5 class="findwine_detail-header--2">Specs</h5>
      <table class="table table-responsive table-sm">
        <tbody>
        {% if winevintage.contains_sulphites %}
        <tr>
          <td class="findwine_detail-content-left">Contains Sulphites:</td>
          <td class="findwine_detail-content-right">{{ winevintage.contains_sulphites|yesno:"Yes,No,Unknown" }}</td>
        </tr>
        {% endif %}
        {% if winevintage.vegetarian %}
        <tr>
          <td class="findwine_detail-content-left">Vegetarian:</td>
          <td class="findwine_detail-content-right">{{ winevintage.vegetarian|yesno:"Yes,No,Unknown" }}</td>
        </tr>
        {% endif %}
        {% if winevintage.residual_sugar %}
        <tr>
          <td class="findwine_detail-content-left">Residual sugar:</td>
          <td class="findwine_detail-content-right">{{ winevintage.residual_sugar }} g/l</td>
        </tr>
        {% endif %}
        {% if winevintage.ph %}
        <tr>
          <td class="findwine_detail-content-left">pH:</td>
          <td class="findwine_detail-content-right">{{ winevintage.ph }}</td>
        </tr>
        {% endif %}
        {% if winevintage.total_acidity %}
        <tr>
          <td class="findwine_detail-content-left">Total acidity:</td>
          <td class="findwine_detail-content-right">{{ winevintage.total_acidity }} g/l</td>
        </tr>
        {% endif %}
        {% if winevintage.total_sulphur %}
        <tr>
          <td class="findwine_detail-content-left">Total sulphur:</td>
          <td class="findwine_detail-content-right">{{ winevintage.total_sulphur|floatformat:1 }} mg/l</td>
        </tr>
        {% endif %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Serving suggestions -->
  <div class="row findwine_detail-rowHeight " id="serve">
    <div class="col-12 col-md-auto">
      <h5 class="findwine_detail-header--2">Serving suggestion</h5>
      <p class="findwine_detail-content hidden-md-up" id="serveContent"> Food pairings, serving temperatures and best years to
        drink. </p>
      <table class="table table-responsive table-sm">
        <tbody>
        <tr>
          <td class="findwine_detail-content-left">Food pairing:</td>
          <td class="findwine_detail-content-right">
            {% if winevintage.winefoodpairing_set.all %}
            <ul class="list-group list-group-flush">
              {% for winefoodpairing in winevintage.winefoodpairing_set.all %}
              <li class="list-group-item findwine_detail-content-list"> {{ winefoodpairing.food_pairing.name }}</li>
              {% endfor %}
            </ul>
            {% else %}
            <p>No food pairings available.</p>
            {% endif %}
          </td>
        </tr>
        {% if winevintage.optimal_year_start %}
        <tr>
          <td class="findwine_detail-content-left">Peak years:</td>
          <td class="findwine_detail-content-right">{{ winevintage.optimal_year_start }} - {{winevintage.optimal_year_end }}
          </td>
        </tr>
        {% endif %}
        {% if winevintage.temp_min %}
        <tr>
          <td class="findwine_detail-content-left">Serve at:</td>
          <td class="findwine_detail-content-right">{{ winevintage.temp_min }} - {{ winevintage.temp_max }} degrees C
          </td>
        </tr>
        {% endif %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="findwine_detail-expand hidden-md-up">
    <button class="btn findwine_detail-expand-button" type="button" id="serveButton" onclick="expandServe()">
      More <img src="{% static 'wine/images/SVGs/arrow-down-green.svg' %}" class="findwine_detail-more-arrow">
    </button>
  </div>
</div>

  <!-- Other vintages -->
  {% if winevintage.other_vintages %}
  <div class="findwine_detail-heading">
    <h5 class="findwine_detail-header findwine_detail-header--desktop">OTHER VINTAGES</h5>
  </div>

  {% for other_vintage in winevintage.other_vintages %}
  <table class="table table-responsive table-sm findwine_vintage-table">
    <tbody>
    <tr class="findwine_search-results">
      <td class="findwine_search-result--table">
        <div
          class="findwine_vintage-rating--box findwine_vintage-rating findwine_rating-box-{{ winevintage.rating_category }}">
          {{ other_vintage.rating.avg_rating|default:"?"}}
        </div>
        <div class="findwine_vintage--image">
          {% if other_vintage.image_pack_shot %}
          <img src="{{ other_vintage.image_pack_shot.url }}" alt="{{ other_vintage.wine.name }}"
               class="img-fluid rounded findwine_vintage--image-img"/>
          {% else %}
          <p>{{ other_vintage.wine.name }}</p>
          {% endif %}
        </div>
        <div class="findwine_vintage-details">
          <a class="findwine_vintage-producer" href={winevintage.details_url}>
            {{ other_vintage.wine.producer.name }}
          </a>
          <h4 class="findwine_vintage-vintage"> {{ other_vintage.wine.name }} {{ other_vintage.year }} </h4>
          <p class="findwine_vintage-category">
            {{ other_vintage.sub_category }}
          </p>
        </div>
      </td>
      {% if other_vintage.preferred_merchant %}
      <td class="findwine_vintage-table--display">
        <div class="findwine_vintage-currency"> R</div>
        <div class="findwine_vintage-price"> {{ other_vintage.preferred_merchant.price }}</div>
        <a class="btn findwine_buy-button hidden-sm-down" href={winevintage.details_url} target="_blank" role="button"> View
          <img src="{% static 'wine/images/SVGs/arrow-right-white.svg' %}"
               class="findwine_detail-right-arrow">
        </a>
      </td>
      {% endif %}
    </tr>
    </tbody>
  </table>
  <div class="findwine_detail-heading hidden-md-up"></div>
  {% endfor %}
  {% endif %}
</div>
  <script>

    function expandInfo() {
      let info = document.getElementById('info');
      let infoButton = document.getElementById('infoButton');

      if (info.style.height !== "auto") {
        info.style.height = "auto";
        infoButton.innerHTML = "Less <img src=\"{% static 'wine/images/SVGs/arrow-down-green.svg' %}\" class=\"findwine_detail-less-arrow\">"
      } else {
        info.style.height = "113px";
        infoButton.innerHTML = "More <img src=\"{% static 'wine/images/SVGs/arrow-down-green.svg' %}\" class=\"findwine_detail-more-arrow\">"
      }

      let infoContent = document.getElementById('infoContent');

      if (infoContent.style.height !== "auto") {
        infoContent.style.height = "auto";
      } else {
        infoContent.style.height = "43px";
      }

    }

    function expandDetail() {

      let detail = document.getElementById('detail');
      let detailButton = document.getElementById('detailButton');

      if (detail.style.height !== "auto") {
        detail.style.height = "auto";
        detailButton.innerHTML = "Less <img src=\"{% static 'wine/images/SVGs/arrow-down-green.svg' %}\" class=\"findwine_detail-less-arrow\">"
      } else {
        detail.style.height = "113px";
        detailButton.innerHTML = "More <img src=\"{% static 'wine/images/SVGs/arrow-down-green.svg' %}\" class=\"findwine_detail-more-arrow\">"
      }

      let detailContent = document.getElementById('detailContent');

      if (detailContent.style.height !== "auto") {
        detailContent.style.height = "auto";
      } else {
        detailContent.style.height = "43px";
      }

    }

    function expandServe() {

      let serve = document.getElementById('serve');
      let serveButton = document.getElementById('serveButton');

      if (serve.style.height !== "auto") {
        serve.style.height = "auto";
        serveButton.innerHTML = "Less <img src=\"{% static 'wine/images/SVGs/arrow-down-green.svg' %}\" class=\"findwine_detail-less-arrow\">"
      } else {
        serve.style.height = "113px";
        serveButton.innerHTML = "More <img src=\"{% static 'wine/images/SVGs/arrow-down-green.svg' %}\" class=\"findwine_detail-more-arrow\">"
      }

      let serveContent = document.getElementById('serveContent');

      if (serveContent.style.height !== "auto") {
        serveContent.style.height = "auto";
      } else {
        serveContent.style.height = "43px";
      }

    }

  </script>

  {% endblock %}
