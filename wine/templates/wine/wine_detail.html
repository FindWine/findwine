{% extends 'wine/base.html' %}
{% load static %}

{% block content %}
<!-- This is the navigation bar at the top of the page-->
<nav class="findwine_detail-nav">
  <!-- Needs to navigate back to search results -->
    <a href="#" class="findwine_detail-back">
      <img src="{% static 'wine/images/SVGs/back-arrow.svg' %}" class="findwine_detail--menu-button">
    </a>
    <div class="findwine_detail-nav--heading">
      Wine Details
    </div>
</nav>

<!--Insert all of the page specific content here-->
<div class="row findwine_detail-padding">

  <!--image-->
  <div class="col-4 col-md-auto">
    {% if winevintage.image_pack_shot %}
    <img src="{{ winevintage.image_pack_shot.url }}" alt="..."
         class="img-fluid rounded float-left findwine_detail-image">
    {% endif %}
  </div>

  <!-- Wine detail -->
  <div class="col-8 col-md-auto">
    <!-- Wine name & vintage year-->
    <a href="#" class="findwine_producer-main"> {{ winevintage.wine.producer }} <img src="{% static 'wine/images/SVGs/arrow-right-grey.svg' %}" class="findwine_detail-right-arrow"> </a>
    <h4 class="findwine_producer-vintage"> {{ winevintage.wine.name }} {{ winevintage.year }} </h4>

    <!-- Wine category & origin -->
    <p class="findwine_category">
      {{ winevintage.category }}
      {% if winevintage.blend %}
      {{ winevintage.blend }}
      {% endif %}
      {{ winevintage.sub_category.name }} </p>
    {% if winevintage.appellation %}

    <p class="findwine_place"><img src="{% static 'wine/images/SVGs/pinpoint.svg' %}"> {{winevintage.appellation.name}},
      {{ winevintage.appellation.get_country_display }}</p>
    {% endif %}
    <!-- Rating -->
    <!-- ** Note to Cory ** -->
    <!-- Need to set background colour dynamically according to rating -->
    <!-- 9-10 Gold  8-9 Silver  < 8 Bronze-->

    <div class="findwine_rating-box {{ winevintage.rating_category }}">
      <p class="findwine_rating">{{ winevintage.rating.avg_rating|floatformat:1 }}</p>
    </div>
    <!-- Awards -->
    {% if winevintage.wineaward_set.all %}
    <ul class="list-group list-group-flush findwine_list-group">
      {% for wineaward in winevintage.wineaward_set.all %}
      <li class="findwine_award-list">
        <div class="findwine_award-list-bullet"></div>
        {{ wineaward.award }}
      </li>
      {% endfor %}
      {% else %}
      <p>No awards captured.</p>
      {% endif %}
    </ul>
  </div>
</div>

<!-- Purchase options -->

<div class="row">
  <div class="col-12 col-md-auto">
    <div class="findwine_detail-heading">
      <h5 class="findwine_detail-header">PURCHASE OPTIONS</h5>
    </div>
    {% if winevintage.merchantwine_set.all %}
    <ul class="list-group list-group-flush">
      {% for merchantwine in winevintage.merchantwine_set.all %}
      <li class="list-group-item findwine_detail-list">
        <div class="findwine_merchant-holder">
          <div class="findwine_merchant-name"> {{ merchantwine.merchant.name }}</div>
          <div class="findwine_merchant-unit"> x{{ merchantwine.minimum_purchase_unit }}</div>
          <div class="findwine_merchant-delivery"> Delivery: {{ merchantwine.merchant.delivery_fees }}</div>
        </div>
        <div class="findwine_merchant-pricing">
          <div class="findwine_merchant-currency"> R</div>
          <div class="findwine_merchant-price"> {{ merchantwine.rounded_price }}</div>
          <a class="btn findwine_buy-button" href={{ merchantwine.url }} target="_blank" role="button"> Buy</a>
        </div>
      </li>
      {% endfor %}
      {% else %}
      <p>No merchant availability.</p>
      {% endif %}
    </ul>
  </div>
</div>

<!-- Wine info -->

<div class="findwine_detail-heading">
  <h5 class="findwine_detail-header">WINE INFO</h5>
</div>

<div class="row findwine_detail-rowHeight" id="info">
  <div class="col-12 col-md-auto">
    <h5 class="findwine_detail-header--2">Description</h5>
    <p class="findwine_detail-content" id="infoContent">{{ winevintage.description }}</p>
    <!-- Include Read more button -->
  </div>
</div>
<div class="findwine_detail-expand">
  <button class="btn findwine_detail-expand-button" type="button" id="infoButton" onclick="expandInfo()">
    More <img src="{% static 'wine/images/SVGs/arrow-down-green.svg' %}" class="findwine_detail-more-arrow">
  </button>
</div>
<div class="findwine_detail-heading"></div>

<!-- Wine details -->
<div class="row findwine_detail-rowHeight" id="detail">
  <div class="col-12 col-md-auto">
    <h5 class="findwine_detail-header--2">Details</h5>
    <p class="findwine_detail-content" id="detailContent"> Read more about the making of this wine and its technical specifications.</p>
    <table class="table table-responsive table-sm">
      <tbody>
      <tr>
        <td class="findwine_detail-content-left">Winemaker:</td>
        <td class="findwine_detail-content">
          {% if winevintage.winemakers.count %}
          {% for winemaker in winevintage.winemakers.all %}
          {{ winemaker }}
          {% endfor %}
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">Alcohol percentage:</td>
        <td class="findwine_detail-content-right">{{ winevintage.alcohol_percentage|floatformat:1 }}%</td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">Blend:</td>
        <td class="findwine_detail-content-right">
          {% if winevintage.winegrape_set.all %}
          <ul class="list-inline">
            {% for winegrape in winevintage.winegrape_set.all %}
            <li class="list-inline-item">{{ winegrape.grape }} {{ winegrape.percentage|floatformat:0 }}%</li>
            {% endfor %}
          </ul>
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">Sweetness:</td>
        <td class="findwine_detail-content-right">{{ winevintage.sweetness }}</td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">Wooded:</td>
        <td class="findwine_detail-content-right">{{ winevintage.wooded|yesno:"Wooded,Unwooded,Unknown" }}</td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">Organic:</td>
        <td class="findwine_detail-content-right">{{ winevintage.organic|yesno:"Yes,No,Unknown" }}</td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">Contains Sulphites:</td>
        <td class="findwine_detail-content-right">{{ winevintage.contains_sulphites|yesno:"Yes,No,Unknown" }}</td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">Vegetarian:</td>
        <td class="findwine_detail-content-right">{{ winevintage.vegetarian|yesno:"Yes,No,Unknown" }}</td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">Residual sugar:</td>
        <td class="findwine_detail-content-right">{{ winevintage.residual_sugar }} g/L</td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">pH:</td>
        <td class="findwine_detail-content-right">{{ winevintage.ph }}</td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">Total acidity:</td>
        <td class="findwine_detail-content-right">{{ winevintage.total_acidity }} g/L</td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">Total sulphur:</td>
        <td class="findwine_detail-content-right">{{ winevintage.total_sulphur|floatformat:1 }} ppm</td>
      </tr>
      </tbody>
    </table>
    {% if winevintage.tasting_notes %}
    <a class="text-primary" style="margin-left:15px"
       href="{{ winevintage.tasting_notes.url|default_if_none:'#' }}">Download tasting notes</a>
    {% endif %}
  </div>
</div>
<div class="findwine_detail-expand">
  <button class="btn findwine_detail-expand-button" type="button" id="detailButton" onclick="expandDetail()">
    More <img src="{% static 'wine/images/SVGs/arrow-down-green.svg' %}" class="findwine_detail-more-arrow">
  </button>
</div>
<div class="findwine_detail-heading"></div>

<!-- Serving suggestions -->
<div class="row findwine_detail-rowHeight" id="serve">
  <div class="col-12 col-md-auto">
    <h5 class="findwine_detail-header--2">Serving suggestion</h5>
    <p class="findwine_detail-content" id="serveContent"> What food to pair the wine with, the temperature to serve it at and the best
      year to
      drink it. </p>
    <table class="table table-responsive table-sm">
      <tbody>
      <tr>
        <td class="findwine_detail-content-left">Food pairing:</td>
        <td class="findwine_detail-content-right">
          {% if winevintage.winefoodpairing_set.all %}
          <ul class="list-group list-group-flush">
            {% for winefoodpairing in winevintage.winefoodpairing_set.all %}
            <li class="list-group-item findwine_detail-content-list"> {{ winefoodpairing.food_pairing.name }}</li>
            {% endfor %}
          </ul>
          {% else %}
          <p>No food pairings available.</p>
          {% endif %}
        </td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">Optimal drinking:</td>
        <td class="findwine_detail-content-right">{{ winevintage.optimal_year_start }} - {{ winevintage.optimal_year_end }}
        </td>
      </tr>
      <tr>
        <td class="findwine_detail-content-left">Serve between:</td>
        <td class="findwine_detail-content-right">{{ winevintage.temp_min }} - {{ winevintage.temp_max }} degrees C</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
<div class="findwine_detail-expand">
  <button class="btn findwine_detail-expand-button" type="button" id="serveButton" onclick="expandServe()">
    More <img src="{% static 'wine/images/SVGs/arrow-down-green.svg' %}" class="findwine_detail-more-arrow">
  </button>
</div>

<!-- Other vintages -->
{% if winevintage.other_vintages %}
<div class="findwine_detail-heading">
  <h5 class="findwine_detail-header">OTHER VINTAGES</h5>
</div>

{% for other_vintage in winevintage.other_vintages %}
<table className="table table-responsive table-sm">
  <tbody>
    <tr class="findwine_search-results">
      <td class="findwine_search-result--table">
        <div class="findwine_vintage-rating--box findwine_vintage-rating"> {{ other_vintage.rating.avg_rating|default:"?"}}
        </div>
        {% if other_vintage.image_pack_shot %}
        <div class="findwine_vintage--image">
          <img src="{{ other_vintage.image_pack_shot.url }}" alt="..."
               class="img-fluid rounded findwine_vintage--image-img"/>
        </div>
        {% endif %}
        <div class="findwine_vintage-details">
          <a class="findwine_vintage-producer" href={winevintage.details_url}>
            {{ other_vintage.wine.producer.name }}
          </a>
          <h4 class="findwine_vintage-vintage"> {{ other_vintage.wine.name }} {{ other_vintage.year }} </h4>
          <p class="findwine_vintage-category">
            {{ other_vintage.sub_category }}
          </p>
        </div>
      </td>
      {% if other_vintage.preferred_merchant %}
      <td class="findwine_vintage-table--display">
        <div class="findwine_vintage-currency"> R</div>
        <div class="findwine_vintage-price"> {{ other_vintage.preferred_merchant.price }}</div>
      </td>
      {% endif %}
    </tr>
  </tbody>
</table>
<div class="findwine_detail-heading"></div>
{% endfor %}
{% endif %}

<script>

  function expandInfo() {
    let info = document.getElementById('info');
    let infoButton = document.getElementById('infoButton');

      if (info.style.height !== "auto") {
        info.style.height="auto";
        infoButton.innerHTML = "Less <img src=\"{% static 'wine/images/SVGs/arrow-down-green.svg' %}\" class=\"findwine_detail-less-arrow\">"
      } else {
        info.style.height="113px";
        infoButton.innerHTML = "More <img src=\"{% static 'wine/images/SVGs/arrow-down-green.svg' %}\" class=\"findwine_detail-more-arrow\">"
      }

    let infoContent = document.getElementById('infoContent');

    if (infoContent.style.height !== "auto") {
      infoContent.style.height="auto";
    } else {
      infoContent.style.height="43px";
    }

  }

  function expandDetail() {

    let detail = document.getElementById('detail');
    let detailButton = document.getElementById('detailButton');

    if (detail.style.height !== "auto") {
      detail.style.height="auto";
      detailButton.innerHTML = "Less <img src=\"{% static 'wine/images/SVGs/arrow-down-green.svg' %}\" class=\"findwine_detail-less-arrow\">"
    } else {
      detail.style.height="113px";
      detailButton.innerHTML = "More <img src=\"{% static 'wine/images/SVGs/arrow-down-green.svg' %}\" class=\"findwine_detail-more-arrow\">"
    }

    let detailContent = document.getElementById('detailContent');

    if (detailContent.style.height !== "auto") {
      detailContent.style.height="auto";
    } else {
      detailContent.style.height="43px";
    }

  }

  function expandServe() {

    let serve = document.getElementById('serve');
    let serveButton = document.getElementById('serveButton');

    if (serve.style.height !== "auto") {
      serve.style.height="auto";
      serveButton.innerHTML = "Less <img src=\"{% static 'wine/images/SVGs/arrow-down-green.svg' %}\" class=\"findwine_detail-less-arrow\">"
    } else {
      serve.style.height="113px";
      serveButton.innerHTML = "More <img src=\"{% static 'wine/images/SVGs/arrow-down-green.svg' %}\" class=\"findwine_detail-more-arrow\">"
    }

    let serveContent = document.getElementById('serveContent');

    if (serveContent.style.height !== "auto") {
      serveContent.style.height="auto";
    } else {
      serveContent.style.height="43px";
    }

  }

</script>

{% endblock %}